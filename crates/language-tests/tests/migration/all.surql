
/**
[env]
imports = ["migration/all_import.surql"]

[env.capabilities]
insecure-storable-closures = true

[test]

[[test.results]]
value = '''[{ details: '', error: 'Found use of function math::min, this function now return `Infinity` when called with an empty array', kind: 'function logical_or', location: { column: 27, kind: 'error', length: 13, line: 1, source: 'DEFINE FUNCTION fn::f10(){math::min([])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function math::sqrt, this function now returns `NaN` when called with a negative number', kind: 'function logical_or', location: { column: 27, kind: 'error', length: 14, line: 1, source: 'DEFINE FUNCTION fn::f11(){math::sqrt(-1)', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'unlikely_break' }, { details: '', error: 'Found future which can be stored in the datastore', kind: 'stored closure', location: { column: 44, kind: 'error', length: 11, line: 1, source: 'DEFINE FUNCTION fn::f12(){CREATE f SET a = ||{(1 + 1)}', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found usage of all idiom `.*` behavior of which has changed when used on an array or object', kind: 'all idiom', location: { column: 34, kind: 'error', length: 2, line: 1, source: 'DEFINE FUNCTION fn::f2(){($param).*', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'can_break' }, { details: '', error: 'Found usage of an idiom with a field followed by another idiom part', kind: 'field idiom followed', location: { column: 34, kind: 'error', length: 8, line: 1, source: 'DEFINE FUNCTION fn::f3(){($param).name[1]', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'can_break' }, { details: '', error: 'Found usage of an `.id` idiom, this field had special behavior for record-ids in 2.0 which has been removed in 3.0', kind: 'id field', location: { column: 34, kind: 'error', length: 3, line: 1, source: 'DEFINE FUNCTION fn::f4(){($param).id', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'can_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::f5(){CREATE foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found use of function array::logical_and, this function now has different behavior', kind: 'function logical_and', location: { column: 26, kind: 'error', length: 35, line: 1, source: 'DEFINE FUNCTION fn::f6(){array::logical_and([true], [false])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function array::logical_or, this function now has different behavior', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 34, line: 1, source: 'DEFINE FUNCTION fn::f7(){array::logical_or([true], [false])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function array::range, this function now has different behavior', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 18, line: 1, source: 'DEFINE FUNCTION fn::f8(){array::range(1, 2)', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'can_break' }, { details: '', error: 'Found use of function math::max, this function now returns `-Infinity` when called with an empty array', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 13, line: 1, source: 'DEFINE FUNCTION fn::f9(){math::max([])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'unlikely_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t5(){INSERT INTO foo {f:<future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 61, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: ') SET a = <future> ( time::now() )', truncation: 'start' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t7(){UPDATE foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t8(){UPSERT foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test'], severity: 'will_break' }, { details: '', error: 'Found use of function math::min, this function now return `Infinity` when called with an empty array', kind: 'function logical_or', location: { column: 27, kind: 'error', length: 13, line: 1, source: 'DEFINE FUNCTION fn::f10(){math::min([])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f10'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function math::sqrt, this function now returns `NaN` when called with a negative number', kind: 'function logical_or', location: { column: 27, kind: 'error', length: 14, line: 1, source: 'DEFINE FUNCTION fn::f11(){math::sqrt(-1)', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f11'], severity: 'unlikely_break' }, { details: '', error: 'Found future which can be stored in the datastore', kind: 'stored closure', location: { column: 44, kind: 'error', length: 11, line: 1, source: 'DEFINE FUNCTION fn::f12(){CREATE f SET a = ||{(1 + 1)}', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f12'], severity: 'will_break' }, { details: '', error: 'Found usage of all idiom `.*` behavior of which has changed when used on an array or object', kind: 'all idiom', location: { column: 34, kind: 'error', length: 2, line: 1, source: 'DEFINE FUNCTION fn::f2(){($param).*', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f2'], severity: 'can_break' }, { details: '', error: 'Found usage of an idiom with a field followed by another idiom part', kind: 'field idiom followed', location: { column: 34, kind: 'error', length: 8, line: 1, source: 'DEFINE FUNCTION fn::f3(){($param).name[1]', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f3'], severity: 'can_break' }, { details: '', error: 'Found usage of an `.id` idiom, this field had special behavior for record-ids in 2.0 which has been removed in 3.0', kind: 'id field', location: { column: 34, kind: 'error', length: 3, line: 1, source: 'DEFINE FUNCTION fn::f4(){($param).id', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f4'], severity: 'can_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::f5(){CREATE foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f5'], severity: 'will_break' }, { details: '', error: 'Found use of function array::logical_and, this function now has different behavior', kind: 'function logical_and', location: { column: 26, kind: 'error', length: 35, line: 1, source: 'DEFINE FUNCTION fn::f6(){array::logical_and([true], [false])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f6'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function array::logical_or, this function now has different behavior', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 34, line: 1, source: 'DEFINE FUNCTION fn::f7(){array::logical_or([true], [false])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f7'], severity: 'unlikely_break' }, { details: '', error: 'Found use of function array::range, this function now has different behavior', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 18, line: 1, source: 'DEFINE FUNCTION fn::f8(){array::range(1, 2)', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f8'], severity: 'can_break' }, { details: '', error: 'Found use of function math::max, this function now returns `-Infinity` when called with an empty array', kind: 'function logical_or', location: { column: 26, kind: 'error', length: 13, line: 1, source: 'DEFINE FUNCTION fn::f9(){math::max([])', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 'f9'], severity: 'unlikely_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t5(){INSERT INTO foo {f:<future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 't5'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 61, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: ') SET a = <future> ( time::now() )', truncation: 'start' }, origin: ['ns', 'test', 'db', 'test', 'function', 't6'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t7(){UPDATE foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 't7'], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 45, kind: 'error', label: 'Incompatible future', length: 24, line: 1, source: 'DEFINE FUNCTION fn::t8(){UPSERT foo SET a = <future> ( time::now() )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'function', 't8'], severity: 'will_break' }, { details: '', error: "The `SEARCH` index has been renamed to `FULLTEXT` and some of it's parameters have been removed", kind: 'search index', location: { column: 21, kind: 'error', length: 24, line: 1, source: 'DEFINE INDEX f ON t1 FULLTEXT ANALYZER az VS', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'table', 't1', 'index', 'f'], severity: 'unlikely_break' }, { details: '', error: 'Found number keys with different types in the same position within a record-id key which will have a different order in 3.0', kind: 'number key ordering', origin: ['ns', 'test', 'db', 'test', 'table', 't2', 'record', { a: [{ b: [false, 0f], c: true }] }], severity: 'can_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 4, kind: 'error', label: 'Incompatible future', length: 14, line: 1, source: '{a:<future> ( 1 )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'table', 't3', 'record', 1], severity: 'will_break' }, { details: '', error: 'Found a future which would be stored in the database', kind: 'incompatible future', location: { column: 4, kind: 'error', label: 'Incompatible future', length: 18, line: 1, source: '{a:<future> ( ( 1 ) )', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'table', 't4', 'record', 1], severity: 'will_break' }, { details: '', error: 'Found future which can be stored in the datastore', kind: 'stored closure', location: { column: 4, kind: 'error', length: 11, line: 1, source: '{a:||{(1 + 1)}', truncation: 'none' }, origin: ['ns', 'test', 'db', 'test', 'table', 't9', 'record', 1], severity: 'will_break' }]'''
*/

migration::diagnose()
