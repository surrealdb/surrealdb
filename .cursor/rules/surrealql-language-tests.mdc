---
description: SurrealQL language testing guidelines
alwaysApply: false
---

# SurrealQL language testing guidelines

## Language test structure

All SurrealQL tests are located in [crates/language-tests/tests/](mdc:crates/language-tests/tests/) with the following organization:

- `parsing/` - Parser and syntax tests
- `language/` - Core language feature tests
- `reproductions/` - Bug reproduction tests

## Test file format

Every `.surql` test file must include metadata header:

```surql
/**
[env]
namespace = true
database = true
auth = { level = "owner" }

[test]
reason = "Brief description of what this tests"
issue = 1234  # Optional: GitHub issue number
run = true

[[test.results]]
value = "expected_result"
# OR
error = true  # if expecting an error
*/

-- Your SurrealQL test queries here
```

## Running language tests

- **Run all tests**: `cd crates/language-tests && cargo run run`
- **Run specific test**: `cd crates/language-tests && cargo run run -- --test path/to/test.surql`
- **Update test results**: `cd crates/language-tests && cargo run update`

## Auto-generating test results

- From `crates/language-tests`, run `cargo run run -- --results accept path/to/test.surql` to populate missing `[[test.results]]` blocks
- Review the generated results before committing them; adjust by hand if they do not capture the intent of the test
- Only use `--results overwrite` after verifying that output changes are expected
- `--results` flags mirror the guidance in `crates/language-tests/README.md`

## Bug reproduction tests

For any reported SurrealQL issue, create a reproduction test:
- File path: `crates/language-tests/tests/reproductions/ISSUE_NUMBER_description.surql`
- Include the issue number in the test metadata
- Use exact SurrealQL from the issue report
- Test with memory storage for consistency: `memory` or `mem://`

## Authentication levels

Common auth levels for tests:
- `{ level = "owner" }` - Full database access
- `{ level = "editor" }` - Read/write access
- `{ level = "viewer" }` - Read-only access
- `false` - No authentication required
