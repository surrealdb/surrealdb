#!/bin/bash
# Script to initialize the benchmark-results branch
# This should be run once to set up the storage structure

set -e

echo "Initializing benchmark-results branch..."

# Save current branch
CURRENT_BRANCH=$(git branch --show-current)

# Create and checkout orphan branch
git checkout --orphan benchmark-results

# Remove all files from staging
git rm -rf . 2>/dev/null || true

# Create directory structure
mkdir -p results

# Create index file
cat > index.json << 'EOF'
{
  "description": "Historical CRUD benchmark results for SurrealDB",
  "structure": {
    "results": "Benchmark results organized by date (YYYY-MM-DD)",
    "format": "Each result file contains JSON output from crud-bench"
  },
  "retention": "Results are kept indefinitely",
  "last_updated": "Initial setup"
}
EOF

# Create README
cat > README.md << 'EOF'
# Benchmark Results Storage

This branch contains historical CRUD benchmark results for performance regression tracking.

## Structure

```
results/
  └── YYYY-MM-DD/
      ├── <commit-sha>-memory.json
      ├── <commit-sha>-rocksdb.json
      └── <commit-sha>-embedded.json
```

## Usage

These results are automatically generated by the benchmark GitHub Actions workflow.
The analysis script compares current benchmark results against the last 30 days
of historical data stored here.

## Retention

Results are stored indefinitely. If storage becomes an issue, older results
can be archived or pruned.
EOF

# Commit initial structure
git add .
git commit -m "Initialize benchmark-results branch"

echo "Benchmark-results branch initialized successfully!"
echo "To push this branch to origin, run:"
echo "  git push origin benchmark-results"
echo ""
echo "Returning to original branch: $CURRENT_BRANCH"
git checkout "$CURRENT_BRANCH"

